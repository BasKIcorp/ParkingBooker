# Архитектура проекта ParkingBooker

## 🏗️ Общий обзор

**ParkingBooker** - это веб-приложение для бронирования парковочных мест в аэропорту Шереметьево. Проект построен на современном стеке технологий с использованием микросервисной архитектуры.

## 🎯 Основные функции

### Для пользователей:
- 📅 Бронирование парковочных мест с указанием даты и времени
- 💰 Автоматический расчет стоимости
- 📱 Адаптивный дизайн для мобильных устройств
- 📊 Просмотр доступности парковочных мест
- ✅ Подтверждение бронирования

### Для администраторов:
- 🔐 Админ панель с авторизацией
- ⚙️ Управление настройками парковки
- 📈 Просмотр статистики бронирований
- 🗄️ Управление базой данных

## 🏛️ Архитектура системы

### Схема архитектуры:
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Nginx (80)    │    │  Flask App      │    │   SQLite DB     │
│   (Reverse      │◄──►│  (Port 5000)    │◄──►│   (Instance)    │
│   Proxy)        │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
   Static Files           Business Logic          Data Storage
   (CSS, JS, Images)     (Routes, Models)       (Bookings, Settings)
```

## 🧩 Компоненты системы

### 1. **Frontend Layer (Презентационный слой)**

#### Структура шаблонов:
```
templates/
├── base.html          # Базовый шаблон с общими элементами
├── index.html         # Главная страница с формой бронирования
├── success.html       # Страница успешного бронирования
├── cancel.html        # Страница отмены бронирования
├── admin.html         # Админ панель
└── admin_login.html   # Страница входа в админ панель
```

#### Статические ресурсы:
```
static/
├── css/               # Стили
├── js/                # JavaScript код
└── images/            # Изображения
```

### 2. **Backend Layer (Бизнес-логика)**

#### Основные модули:

**`app.py`** - Конфигурация приложения:
- Инициализация Flask приложения
- Настройка базы данных SQLAlchemy
- Конфигурация логирования
- Инициализация моделей по умолчанию

**`routes.py`** - Маршруты и контроллеры:
- `/` - Главная страница
- `/book_parking` - Обработка бронирования
- `/success/<id>` - Страница успеха
- `/admin` - Админ панель
- `/admin/login` - Авторизация админа
- `/admin/update_settings` - Обновление настроек

**`models.py`** - Модели данных:
- `ParkingSettings` - Настройки парковки
- `Booking` - Бронирования
- `AdminUser` - Пользователи админ панели

**`utils.py`** - Утилиты:
- `get_available_spots_for_hour()` - Расчет доступных мест
- `validate_russian_phone()` - Валидация телефона
- Вспомогательные функции

### 3. **Data Layer (Слой данных)**

#### База данных SQLite:
- **Локация**: `instance/parking.db`
- **Схема**: Автоматически создается при первом запуске
- **Миграции**: Поддержка Alembic

#### Основные таблицы:

**`parking_settings`**:
```sql
- id (Primary Key)
- total_spots (Общее количество мест)
- reserve_spots (Зарезервированные места)
- hourly_price (Цена за час)
- created_at, updated_at (Timestamps)
```

**`booking`**:
```sql
- id (Primary Key)
- first_name, last_name (Имя и фамилия)
- phone (Телефон)
- booking_date (Дата бронирования)
- booking_start_hour, booking_end_hour (Время)
- total_amount (Общая стоимость)
- created_at, updated_at (Timestamps)
```

**`admin_user`**:
```sql
- id (Primary Key)
- username (Логин)
- password_hash (Хеш пароля)
- created_at (Timestamp)
```

## 🐳 Контейнеризация

### Docker архитектура:

**`Dockerfile`** - Основной образ приложения:
```dockerfile
FROM python:3.11-slim
# Установка зависимостей
# Копирование кода
# Настройка пользователя
# Запуск через gunicorn
```

**`Dockerfile.nginx`** - Nginx контейнер:
```dockerfile
FROM nginx:alpine
# Конфигурация nginx
# Статические файлы
# SSL поддержка
```

**`docker-compose.yml`** - Оркестрация:
```yaml
services:
  web:     # Flask приложение
  nginx:   # Обратный прокси
networks:
  app-network: # Сеть для коммуникации
```

## 🔧 Конфигурация

### Переменные окружения:
```bash
FLASK_APP=app.py
FLASK_ENV=production
SESSION_SECRET=your-secret-key
DATABASE_URL=sqlite:///parking.db
```

### Настройки по умолчанию:
- **Общее количество мест**: 50
- **Зарезервированные места**: 5
- **Цена за час**: 100.0 руб.
- **Админ логин**: admin
- **Админ пароль**: admin123

## 🔄 Жизненный цикл запроса

### 1. **Пользовательский запрос**:
```
Пользователь → Nginx (80) → Flask App (5000) → SQLite DB
```

### 2. **Процесс бронирования**:
```
1. Пользователь заполняет форму
2. Валидация данных на клиенте
3. Отправка POST запроса
4. Валидация на сервере
5. Проверка доступности мест
6. Расчет стоимости
7. Сохранение в БД
8. Отправка подтверждения
```

### 3. **Админ операции**:
```
1. Авторизация в админ панели
2. Просмотр статистики
3. Изменение настроек
4. Управление бронированиями
```

## 🛡️ Безопасность

### Реализованные меры:
- ✅ Валидация входных данных
- ✅ Защита от SQL инъекций (SQLAlchemy ORM)
- ✅ Хеширование паролей
- ✅ Сессии с секретным ключом
- ✅ HTTPS поддержка (в продакшн)
- ✅ Заголовки безопасности (nginx)

### Админ безопасность:
- 🔐 Авторизация по логину/паролю
- 🚪 Сессии с таймаутом
- 🛡️ CSRF защита
- 📝 Логирование действий

## 📊 Мониторинг и логирование

### Логирование:
- **Flask**: Логи запросов и ошибок
- **Nginx**: Access и error логи
- **Docker**: Логи контейнеров

### Мониторинг:
- **Health checks**: Проверка здоровья сервисов
- **GitHub Actions**: Автоматический деплой
- **SSL мониторинг**: Проверка сертификатов

## 🚀 Развертывание

### Локальная разработка:
```bash
python main.py
# http://localhost:5000
```

### Docker разработка:
```bash
docker-compose up --build
# http://localhost:80
```

### Продакшн:
```bash
docker-compose -f docker-compose.prod.yml up -d
# https://your-domain.com (SSL)
```

## 🔄 CI/CD Pipeline

### GitHub Actions:
1. **Deploy** - Автоматический деплой при push
2. **Test** - Тестирование кода и Docker образов
3. **Security** - Сканирование уязвимостей
4. **Monitor** - Мониторинг здоровья приложения

### Автоматизация:
- ✅ Автоматическое развертывание
- ✅ Создание SSL сертификатов
- ✅ Проверка здоровья сервисов
- ✅ Очистка неиспользуемых ресурсов

## 📈 Масштабируемость

### Текущие ограничения:
- SQLite база данных (однопользовательская)
- Один экземпляр приложения

### Возможности расширения:
- 🔄 Миграция на PostgreSQL/MySQL
- 🐳 Горизонтальное масштабирование
- 🔄 Кэширование (Redis)
- 📊 Мониторинг (Prometheus/Grafana)
- 🔄 Балансировка нагрузки

## 🛠️ Технологический стек

### Backend:
- **Python 3.11** - Основной язык
- **Flask** - Веб-фреймворк
- **SQLAlchemy** - ORM
- **SQLite** - База данных
- **Gunicorn** - WSGI сервер

### Frontend:
- **HTML5** - Разметка
- **CSS3** - Стили
- **JavaScript** - Интерактивность
- **Bootstrap** - UI фреймворк

### DevOps:
- **Docker** - Контейнеризация
- **Nginx** - Обратный прокси
- **GitHub Actions** - CI/CD
- **SSL/TLS** - Шифрование

## 📋 Структура файлов

```
ParkingBooker/
├── 📁 .github/workflows/     # GitHub Actions
├── 📁 static/                # Статические файлы
│   ├── css/
│   ├── js/
│   └── images/
├── 📁 templates/             # HTML шаблоны
├── 📁 migrations/            # Миграции БД
├── 📁 instance/              # База данных
├── 📁 ssl/                   # SSL сертификаты
├── 📄 app.py                 # Конфигурация Flask
├── 📄 models.py              # Модели данных
├── 📄 routes.py              # Маршруты
├── 📄 utils.py               # Утилиты
├── 📄 main.py                # Точка входа
├── 📄 Dockerfile             # Docker образ
├── 📄 docker-compose.yml     # Docker Compose
├── 📄 nginx.conf             # Nginx конфигурация
├── 📄 req.txt                # Python зависимости
└── 📄 README.md              # Документация
```

## 🎯 Преимущества архитектуры

### ✅ Простота развертывания:
- Один Docker Compose файл
- Автоматический деплой через GitHub Actions
- Минимальная конфигурация

### ✅ Надежность:
- Health checks
- Автоматические бэкапы
- Мониторинг и алерты

### ✅ Безопасность:
- HTTPS в продакшн
- Валидация данных
- Защита от атак

### ✅ Масштабируемость:
- Микросервисная архитектура
- Контейнеризация
- Возможность горизонтального масштабирования

## 🔮 Планы развития

### Краткосрочные:
- 📊 Улучшение админ панели
- 📱 Мобильное приложение
- 🔔 Email уведомления

### Долгосрочные:
- 🔄 Миграция на PostgreSQL
- 🐳 Kubernetes развертывание
- 📊 Аналитика и отчеты
- �� API для интеграций 